/* This file was minimized by http://jscompress.com/
 * If you are interested in the original, point your browser to map_original.js */
function xmlGetRequestSync(e,t){if(window.XMLHttpRequest){xmlReq=new XMLHttpRequest}else if(window.ActiveXObject){xmlReq=new ActiveXObject("Microsoft.XMLHTTP")}else{return null}if(t!=null){e=e+"?"+t}xmlReq.open("GET",e,false);xmlReq.send(null);if(xmlReq.status==200){return xmlReq.responseText}return null}function openlayers_defined(){if(typeof OpenLayers=="undefined")return false;else return true}function google_api_defined(){if(typeof google!="undefined"&&typeof google.maps!="undefined"&&typeof google.maps.MapTypeId!="undefined"){return true}else{return false}}function coord_elems_exists(){if(document.getElementById(coord_elem_lon)!=null&&document.getElementById(coord_elem_lat)!=null){return true}return false}function get_poi_url_bbox(e){if(typeof e=="undefined"){var e="0"}return urlPoi+"?format=txt"+"&groups="+e}function onFeatureSelect(e){if(!e.cluster){var t=e.feature.cluster[0];if(e.feature.attributes.count<2){var n="<h1>"+t.attributes.title+"</h1>"+t.attributes.description}else{var n="<h1>Mehrere Punkte in dem Gebiet</h1>Reinzoomen um mehr zu sehen"}popup=new OpenLayers.Popup.FramedCloud("nix",t.geometry.getBounds().getCenterLonLat(),new OpenLayers.Size(100,100),n,null,true,onPopupClose);popup.maxSize=new OpenLayers.Size(500,500);t.popup=popup;map.addPopup(popup)}}function closePopup(e){if(e&&e.popup){map.removePopup(e.popup);e.popup.destroy();delete e.popup;return true}return false}function onFeatureUnselect(e){if(!e.cluster&&e.feature){var t=e.feature.cluster[0];closePopup(t)}}function setClustering(e){for(x in clusterStrategies){if(e){if(clusterStrategies[x].distance_old!=0){clusterStrategies[x].distance=clusterStrategies[x].distance_old;clusterStrategies[x].distance_old=0}else{break}}else{if(clusterStrategies[x].distance_old==0){clusterStrategies[x].distance_old=clusterStrategies[x].distance;clusterStrategies[x].distance=1}else{break}}}}function eventMoveEnd(e){if(e.zoomChanged==true){if(e.object.map.zoom<18){setClustering(true)}else{setClustering(false)}features=e.object.features;for(featnum in features){myfeat=features[featnum];if(myfeat.cluster.length>0){closePopup(features[featnum].cluster[0])}}}}function onPopupClose(e){select.unselectAll()}function setCenter4326(e,t){map.setCenter(e.transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection("EPSG:900913")),t)}function init(){if(!openlayers_defined()){document.getElementById("map").innerHTML="<strong>OpenLayers not defined.<br />* Maybe you didnt enable JavaScript.<br />* Maybe OpenLayers or your connection to Openlayers is broken.<br /><br />On further errors, write to the mail-adress you can find under contacts.</strong>";return false}map=new OpenLayers.Map("map",{maxExtent:new OpenLayers.Bounds(-20037508.34,-20037508.34,20037508.34,20037508.34),numZoomLevels:30,maxResolution:156543.0399,units:"m",projection:new OpenLayers.Projection("EPSG:4326"),displayProjection:new OpenLayers.Projection("EPSG:4326")});var layerOsm=new OpenLayers.Layer.OSM;map.addLayers([layerOsm]);if(google_api_defined()){var ghyb=new OpenLayers.Layer.Google("Google Hybrid",{type:google.maps.MapTypeId.HYBRID,numZoomLevels:20});map.addLayers([ghyb])}map.addControl(new OpenLayers.Control.LayerSwitcher);map.addControl(new OpenLayers.Control.ScaleLine);if(coord_elems_exists()){var click=new OpenLayers.Control.Click;map.addControl(click);click.activate()}map.setCenter(0,0,30);var group_req=xmlGetRequestSync(urlGroups,null);if(group_req!=null){var groups=eval(group_req)}for(groupnum in groups){group=groups[groupnum];var style=new OpenLayers.Style({externalGraphic:"${externalGraphic}",graphicWidth:"${graphicWidth}",graphicHeight:"${graphicHeight}",graphicXOffset:"${graphicXOffset}",graphicYOffset:"${graphicYOffset}",graphicOpacity:.7},{context:{externalGraphic:function(e){if(e.attributes.count>1){return groups[e.layer.groupnum].multi_icon}else{return groups[e.layer.groupnum].icon}},graphicWidth:function(e){if(e.attributes.count>1){return parseInt(groups[e.layer.groupnum].multi_iconw)}else{return parseInt(groups[e.layer.groupnum].iconw)}},graphicHeight:function(e){if(e.attributes.count>1){return parseInt(groups[e.layer.groupnum].multi_iconh)}else{return parseInt(groups[e.layer.groupnum].iconh)}},graphicXOffset:function(e){if(e.attributes.count>1){return parseInt(groups[e.layer.groupnum].multi_iconx)}else{return parseInt(groups[e.layer.groupnum].iconx)}},graphicYOffset:function(e){if(e.attributes.count>1){return parseInt(groups[e.layer.groupnum].multi_icony)}else{return parseInt(groups[e.layer.groupnum].icony)}}}});var strategy_cluster=new OpenLayers.Strategy.Cluster({distance:Math.floor(Math.max(group.iconh,group.iconw)),distance_old:0});clusterStrategies.push(strategy_cluster);var strategy_bbox=new OpenLayers.Strategy.BBOX;var layer=new OpenLayers.Layer.Vector(group.name,{projection:map.displayProjection,strategies:[strategy_bbox,strategy_cluster],styleMap:new OpenLayers.StyleMap({"default":style,select:{graphicOpacity:1}}),protocol:new OpenLayers.Protocol.HTTP({url:get_poi_url_bbox(group.id),format:new OpenLayers.Format.Text({})})});layer.groupnum=groupnum;layer.events.on({featureselected:coord_elems_exists()?null:onFeatureSelect,featureunselected:coord_elems_exists()?null:onFeatureUnselect,moveend:eventMoveEnd});map.addLayer(layer);strategy_bbox.update({force:true});poiLayers.push(layer)}select=new OpenLayers.Control.SelectFeature(poiLayers,{onSelect:onFeatureSelect,onUnselect:onFeatureUnselect});map.addControl(select);select.activate()}var map;var poiLayers=new Array;var clusterStrategies=new Array;var select;var coord_elem_lon="entry_lon";var coord_elem_lat="entry_lat";var urlPoi="export.php";var urlGroups="groups.php";if(openlayers_defined()){OpenLayers.Control.Click=OpenLayers.Class(OpenLayers.Control,{defaultHandlerOptions:{single:true,"double":false,pixelTolerance:0,stopSingle:false,stopDouble:false},initialize:function(e){this.handlerOptions=OpenLayers.Util.extend({},this.defaultHandlerOptions);OpenLayers.Control.prototype.initialize.apply(this,arguments);this.handler=new OpenLayers.Handler.Click(this,{click:this.trigger},this.handlerOptions)},trigger:function(e){var t=map.getLonLatFromPixel(e.xy).transform(this.map.getProjectionObject(),this.map.displayProjection);document.getElementById(coord_elem_lon).value=t.lon;document.getElementById(coord_elem_lat).value=t.lat;alert("Koordinaten gesetzt")}})}
